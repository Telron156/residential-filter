name: Proxy Check & Update

on:
  schedule:
    - cron: '0 */2 * * *'  # –ó–∞–ø—É—Å–∫ –∫–∞–∂–¥—ã–µ 2 —á–∞—Å–∞
  workflow_dispatch:       # –ö–Ω–æ–ø–∫–∞ —Ä—É—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞

permissions:
  contents: write

jobs:
  check-proxies:
    runs-on: ubuntu-latest
    timeout-minutes: 100

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'

    - name: Install dependencies
      run: npm install

    - name: Run Checker
      # –°–∫—Ä–∏–ø—Ç —Å–∞–º –æ—Ç–∫—Ä–æ–µ—Ç sources.txt, —Å–∫–∞—á–∞–µ—Ç —Å—Å—ã–ª–∫–∏ –æ—Ç—Ç—É–¥–∞ –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç –ø—Ä–æ–∫—Å–∏
      run: node index.js

    - name: Commit results
      run: |
        git config --global user.name "ProxyBot"
        git config --global user.email "bot@users.noreply.github.com"
        
        # –î–æ–±–∞–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏
        git add valid_proxies.txt valid_proxies_ru.txt
        
        # –ö–æ–º–º–∏—Ç–∏–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
        git diff --quiet && git diff --staged --quiet || (git commit -m "üöÄ Update proxies $(date)" && git push)
