name: Proxy Check & Update

on:
  # schedule:
  #   - cron: '0 */2 * * *'  # –ó–∞–ø—É—Å–∫ –∫–∞–∂–¥—ã–µ 2 —á–∞—Å–∞
  workflow_dispatch:       # –ö–Ω–æ–ø–∫–∞ —Ä—É—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞

permissions:
  contents: write

jobs:
  check-proxies:
    runs-on: ubuntu-22.04
    timeout-minutes: 100

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'

    - name: Install dependencies
      run: npm install

    - name: Run Checker
      # –°–∫—Ä–∏–ø—Ç —Å–∞–º –æ—Ç–∫—Ä–æ–µ—Ç sources.txt, —Å–∫–∞—á–∞–µ—Ç —Å—Å—ã–ª–∫–∏ –æ—Ç—Ç—É–¥–∞ –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç –ø—Ä–æ–∫—Å–∏
      run: node index.js

    - name: Commit results
      if: always()  # <--- –í–û–¢ –≠–¢–û –ì–õ–ê–í–ù–û–ï: –í—ã–ø–æ–ª–Ω—è—Ç—å —à–∞–≥, –¥–∞–∂–µ –µ—Å–ª–∏ –ø—Ä–µ–¥—ã–¥—É—â–∏–π —É–ø–∞–ª
      run: |
        git config --global user.name "ProxyBot"
        git config --global user.email "bot@users.noreply.github.com"
        
        # –î–æ–±–∞–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ (–¥–∞–∂–µ –µ—Å–ª–∏ —Å–∫—Ä–∏–ø—Ç —É–ø–∞–ª, —Ñ–∞–π–ª —É–∂–µ —á–∞—Å—Ç–∏—á–Ω–æ –∑–∞–ø–æ–ª–Ω–µ–Ω)
        # –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ: git add –Ω–µ —É–ø–∞–¥–µ—Ç, –¥–∞–∂–µ –µ—Å–ª–∏ —Ñ–∞–π–ª –Ω–µ –∏–∑–º–µ–Ω–∏–ª—Å—è
        git add valid_proxies.txt
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å, –µ—Å—Ç—å –ª–∏ —á—Ç–æ –∫–æ–º–º–∏—Ç–∏—Ç—å
        if [[ -n $(git status -s) ]]; then
          echo "Changes detected, committing..."
          git commit -m "üöÄ Update proxies $(date)"
          git push
        else
          echo "No changes to commit."
        fi
